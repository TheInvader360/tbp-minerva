#{extends 'main.html' /}
#{set title:'Minerva - ' + book.sku /}

${book.sku}

<br>

#{if selectedSalesChannel != null}
  ${selectedSalesChannel.name}
#{/if}
#{else}
  Combined
#{/else}

<br>

<a href="@{Application.showBookDetail(book.isbn)}">
  Combined
</a>
<br>
#{list items:allSalesChannels, as:'salesChannel'}
  <a href="@{Application.showBookDetail(book.isbn, salesChannel.tag)}">
    ${salesChannel.name}<br>
  </a>
#{/list}

<div id="chart" style="height:200px;"></div>

<p>
  Sales Summary Rows: ${book.salesSummaries.size()}
</p>
<p>
  #{list items:book.salesSummaries, as:'salesSummary'}
    ${salesSummary.salesChannel.tag} ${salesSummary.summaryDate} ${salesSummary.salesQuantity}<br>
  #{/list}
</p>
	
<script class="code" type="text/javascript">
  $(document).ready(function () {
    
    #{if selectedSalesChannel != null}
      var data = [${book.getChartData(selectedSalesChannel.tag)}];
    #{/if}
    #{else}
      var data = [${book.getChartData('all')}];
    #{/else}
    plot = $.jqplot("chart", [data], {
      // Turns on animation for all series in this plot.
      animate: true,
      // Will animate plot on calls to plot.replot({resetAxes:true})
      animateReplot: true,
      cursor: {
        show: false,
        zoom: false,
        looseZoom: false,
        showTooltip: true
      },
      series:[
        {
          rendererOptions: {
            // speed up the animation a little bit.
            // This is a number of milliseconds.
            // Default for a line series is 2500.
            animation: {
              speed: 2000
            }
          }
        }
      ],
      axesDefaults: {
        pad: 0
      },
      axes: {
        xaxis:{
          renderer:$.jqplot.DateAxisRenderer, 
          tickOptions:{formatString:'%b %y'},
          tickInterval:'1 month',
          min: data[0][0],
          max: data[0][data[0].length]
        },
        yaxis: {
          rendererOptions: {
            forceTickAt0: true
          }
        },
      },
      highlighter: {
        show: true, 
        showLabel: true, 
        tooltipAxes: 'y',
        sizeAdjust: 7.5 , tooltipLocation : 'n'
      }
    });
  });
  $(window).bind('resize', function(event, ui) {
    plot.replot({resetAxes:false});
  });
</script>
<script class="include" type="text/javascript" src="@{'/public/javascripts/jqplot/jquery.jqplot.min.js'}"></script>
<script class="include" type="text/javascript" src="@{'/public/javascripts/jqplot/plugins/jqplot.dateAxisRenderer.min.js'}"></script>
<script class="include" type="text/javascript" src="@{'/public/javascripts/jqplot/plugins/jqplot.highlighter.min.js'}"></script>
